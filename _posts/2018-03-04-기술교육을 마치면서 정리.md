---
layout: post
title:  "기술교육을 마치면서 정리"
---
기획 단계
---

그륩웨어의 요구사항을 바탕으로 서비스에 대한 기획을 해보았다. 처음에 요구사항을 받았을 때에는 그냥 요구사항대로만 하면 될거라고 생각했다. 하지만 실제로 기획을 해보니 우리 생각보다 더 세부적이고 깊은 부분 까지 전부 고려해서 기획서에 들어가 있어야 된다는 것을 알게 됬다. 개발기간이 짧아서 시간이 어느정도 걸릴지 잘 예상해서 계획을 해야했는데, 플래닝 포커를 통해서 같은 기능에 대해 개발 예상 시간이 사람마다 모두 다르다는 것을 알게되었다. 기획 단계에서 가장 큰 문제였던 부분은 DB 설계 였다. 기획서에 나온대로 사용자마다 같은 메일을 복사해서 저장하려면 데이터베이스에 중복자료가 많이 들어가게 되고 정규화도 할 수 없기 때문이었다. 정말로 이렇게 설계 해도 되나? 이런 고민들을 많이 했던것 같다.



서비스 개발 단계
---

기획서를 바탕으로 실제 서비스를 개발하는 단계였다. 처음할 때 어려웠던 부분은 스프링 프레임워크에 대해 기반지식이 전혀 없어서 코드를 어떤 구조로 짜야할지 였다. Controller, Service, Mapper로 대략적인 구조를 짜고 난 뒤에는 Controller와 Service에 어떤 내용의 코드가 들어가 있어야 되는지를 고민했다. Service에는 비즈니스 로직만 있는게 더 좋은 구조의 코드가 됀다고 생각해서 Controller에는 최대한 로직을 빼려고 했다. 또한 처음 프로토타입형식으로 만들었을때에는 로그인을 체크하는 부분이 전부 Controller에 있었는데, 이것도 Spring의 AOP라는 기능을 이용해서 따로 빼버리니 관심사별로 코드가 잘 분리되어 Controller 단이 굉장히 깔끔해지고 보기 좋아졌다. 또한 Javascript로 ajax 통신을 통해 비동기 이벤트 식으로 메일 삭제나 리스트 가져와서 화면에 뿌려주기 등을 개발했었다. ajax 통신을 개발하면서 Javascript자체도 많이 배웠지만 Spring에서도 API 처럼 만들기 위해서 고민을 많이 했었다.



코드 리팩토링
---

TDD나 Unit Test라는 개념이 익숙하지 않아서 처음 테스트 코드를 짤때에는 이렇게 해도 되는것인가 이런 생각이 많이 들었다. 테스트 코드를 개발하면서 느꼈던 점이라면 테스트코드를 짜서 젠킨스의 커버리지를 올리는 것이 굉장히 번거롭고 당장에 시간만 더 쓰는 것 같지만, 코드를 리팩토링하거나 수정했을때 그 내용을 검증하는 데에 좋은 기반이 되어 장기적으로 엄청 편해진다는 것이다. 

개발했던 코드를 리팩토링하는 부분은 베이스캠프 내내 계속 지속적으로 했었고 메일박스별로 IF문으로 구분하던 걸 ENUM을 통해 없애는 방법, 메일 쓰기에서 파라미터가 너무 많은 부분을 객체로 묶어서 받는 부분(json 데이터를 받았을 때 Spring이 알아서 객체로 매핑해줘서 신기했다.), 복잡한 함수들을 관심사를 분리해서 좀더 읽기 좋게 나누는 부분, 그 외에도 많은 부분들을 배웠다. 리팩토링에서 가장 어려웠던 부분은 네이밍이었다. 자바컨벤션 이라는 기준이 있었지만 너무 길지 않으면서, 코드의 내용을 잘 함축하고, 이중적인 의미로 읽히지 않는 네이밍을 생각해내는 것은 정말 어려웠다.



웹 서버 스케일 아웃
---

웹 서버를 스케일 아웃 했을때 생기는 이슈 2가지를 배웠다. 첫번째로 두 웹서버 간의 세션이었다. 웹 서버가 두개가 되므로 세션을 그대로 사용한다면 한 웹서버에서만 세션이 유지되고 다른 웹서버에서는 세션이 유지되지 않기에, 세션을 공유할 방법이 필요했다. 이를 위한 방법으로 Redis나 DB를 사용해서 세션을 공유하게 하는 방법을 배웠다. 처음에 우리 TF는 스프링 자체 설정을 통해 구현해서 이렇게 해도 되는 것인가 했었는데, 그렇게 하면 안되는거였다. 그래서 실제로는 직접 Redis나 DB와 통신하면서 직접 쿠키를 만들어 보내주는 식으로 구현했다. 두번째로는 파일이었다. 웹서버가 두개가 되기에 파일을 로컬에 저장하면 안되고 공통 저장소에 저장해야 했다. 공통저장소로 토스트클라우드의 Object Storage를 사용했다. Object Storage는 Http 통신을 통해 API를 호출해서 사용할 수 있었고, REST방식으로 API를 부르게 되어있어서 REST방식의 Http 통신에 대해 배울 수 있었다. 이 부분을 구현하면서 고민이었던게 복사 기능을 구현할 떄 HTTP 요청을 COPY로 보내야 했다. COPY를 지원하는 HttpClient가 스프링에는 없어서 지원하는 걸 찾기위해 여러가지를 시험해봐야 했었다. 또한 Object Storage에 접근할 때 사용하는 Token의 갱신도 다른 TF와 코드리뷰를 하면서 고민했었다. 원래는 토큰의 유효기간이 1시간이기에 그보다 5분정도 빠르게 55분마다 토큰을 갱신하게 만들었었는데, 새 Token을 발급받으면 기존 토큰은 못쓰게 되는게 아닌가? 라는 생각이 들어서 테스트 해보았다. 다행히 새 토큰을 받는다고 기존 토큰이 무효화되지는 않았다.



DB 스케일 아웃
---

데이터 베이스 확장을 위해서 샤딩을 하는 단계였다. TF들의 모든 서비스가 알고보니 큰 서비스의 일부였다는 반전도 있었다. 먼저 우리 TF의 로컬DB를 샤딩하는 부분에서 고민이었던 부분은 Datasource를 나누는 부분을 어디에 넣을지 였다. 아무래도 여태까지 배운내용을 바탕으로 생각해보면 Controller나 Service에 넣으면 안되고 관심사를 분리해서 따로 넣어야 돼는데, Controller 앞에 넣을지, Mapper 앞에 넣을지 TF에서 고민했었다. Controller에 넣으면 반복작업이 없어진다는 점에서 좋지만 메일 쓰기에서 보낸 유저 여러명에게 Insert를 하는 부분이 있어서 이때만 따로 해줘야 된다는 이슈가 있었고, Mapper 앞에 넣으면 한번 호출에 쿼리를 여러번 하는 경우 쓸데없이 똑같은 작업을 여러번 해야한다는 성능적인 이슈가 있었다. 그래서 멘토님들과 회의를 하고 Controller에서 하는 걸로 결정했었다. 또한 로그인시 다른 TF로 리다이렉트 하는 부분과 이메일을 주고받는 부분도 해야했다. 이 부분은 JSON을 이용한 HTTP 통신으로 했고, 개발 자체보다 다른 TF라는 고려요소가 새로 생겨나서 메일쓰기부분의 코드 구조를 많이 바꿔야했다. 기존에는 메일쓰기 부분에 받는 부분까지 들어가있어서 이 둘을 서로 다른 분리하는 식으로 코드를 리팩토링 했고, TF별로 메일을 보내는 부분은 예전에 메일박스할떄 ENUM을 통해 IF문을 제거했던 기억을 되살려서 구현했다.



운영
---

실제로 서비스를 운영하는 것을 고려하는 것은 개발하는 것과는 또 다른 문제였다.

* 모니터링

* 문제 발생시 원인 분석

* 문제가 생겼을때 롤백

* 서버에 문제시 자동 재구동

* 실제 운영시 성능



등등 고려해야 될게 굉장히 많았다. 또한 중간에 다른 TF와 QA를 했었는데, QA를 통해서 내가 볼수 없었던 수많은 버그들을 알 수 있었고 고칠 수 있었다.



느낀점
---

단순히 코드를 개발하는 것과 실제로 서비스를 만드는 것은 정말 다른 이야기라는 걸 알게 됐다. 실제 서비스 개발부터 릴리즈를 위해서는 기획부터 개발, 서비스 확장성 고려(웹서버,DB 스케일 아웃), 운영 등 정말 많은 단계가 필요하다는 걸 배웠다. 교육을 받으면서 내가 이 모든 내용들을 완벽히 자세한 부분까지 배우지는 못했다. 하지만 서비스 개발과 운영이라는 어떤 사이클의 큰 그림을 배울 수 있었고, 그 큰 그림의 작은 요소요소들이 왜 필요하고 어떤식으로 만들어내는지 알수 있었다. 우리 회사에서 어떻게 소프트웨어 개발을 하는지 배우는 정말 좋은 시간이었다.